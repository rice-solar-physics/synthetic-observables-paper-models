%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                   Results                                   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}\label{results}

\begin{pycode}[manager_results]
manager_results = texfigure.Manager(
    pytex,
    './',
    number=2,
    python_dir='python',
    fig_dir='figures',
    data_dir='data'
)
from formatting import qualitative_palette, heating_palette
\end{pycode}

We forward model time-dependent AIA intensities using the method outlined in \autoref{forward} for the heating scenarios discussed in \autoref{heating}. We discuss the predicted intensities in \autoref{intensities} for all six EUV channels of AIA and all five heating models. In \autoref{em_slopes} and \autoref{timelags}, we show the results of the emission measure and timelag analysis, respectively, applied to our simulated data. In \citetalias{barnes_understanding_2019-1}, we use these simulated observables to train a machine learning classification model to understand with which heating scenario the real data are most consistent.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Intensities %%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Intensities}\label{intensities}

We compute the intensities for the 94, 131, 171, 193, 211, and 335 \AA{} channels of SDO/AIA using the procedure described in \autoref{forward}. We compute the intensity in each pixel of the model \AR{} over a total simulation period of $3\times10^4\,\mathrm{s}\,\approx8.3$ hours with the exception of the cooling case which is only run for $10^4$ s. For the high-, intermediate-, and low-frequency and ``random'' models, we discard the first and last $5\times10^3$ s of evolution to avoid any transient effects in the strand evolution associated with the initial conditions. We complete this procedure for each of the five heating scenarios in \autoref{tab:heating}.

\begin{pycode}[manager_results]
fig = plt.figure(figsize=texfigure.figsize(
    pytex,
    scale=1 if is_onecolumn() else 2,
    height_ratio=0.5, 
    figure_width_context='columnwidth'
))
plt.subplots_adjust(hspace=0.03,wspace=0.03)
t = 1500
path_format = os.path.join(manager_results.data_dir, '{}', 'map_t{:06d}_{}.fits')
for i,f in enumerate(heating):
    for j,c in enumerate(channels):
        m = Map(path_format.format(f,t,c))
        m = m.submap(SkyCoord(Tx=-390*u.arcsec,Ty=-325*u.arcsec,frame=m.coordinate_frame),
                     SkyCoord(Tx=-215*u.arcsec,Ty=-150*u.arcsec,frame=m.coordinate_frame))
        ax = fig.add_subplot(3,6,6*i+j+1,projection=m)
        norm = ImageNormalize(
            vmin=0,vmax=Map(path_format.format('low_frequency',t,c)).data.max(),
            stretch=SqrtStretch())
        m.plot(axes=ax,title=False,annotate=False,norm=norm)
        ax.grid(alpha=0)
        lon,lat = ax.coords
        lon.set_ticks(color='w',number=2)
        lat.set_ticks(color='w',number=2)
        lon.frame.set_linewidth(0)
        lat.frame.set_linewidth(0)
        if i==len(heating)-1 and j==1:
            lon.set_axislabel(r'Helioprojective Longitude',)
        else:
            lon.set_ticklabel_visible(False)
        if i==len(heating)-2 and j==0:
            lat.set_ticklabel(rotation='vertical')
            lat.set_axislabel(r'Helioprojective Latitude',)
        else:
            lat.set_ticklabel_visible(False)
        if i==0:
            ax.set_title(f'{c} $\mathrm{{\AA}}$')
        if j == 0:
            xtext,ytext = m.world_to_pixel(
                SkyCoord(-375*u.arcsec, -175*u.arcsec, frame=m.coordinate_frame))
            ax.text(xtext.value,ytext.value,f'{f.split("_")[0].capitalize()}',
                    color='w',fontsize=plt.rcParams['legend.fontsize'])
fig_intensity_maps = manager_results.save_figure('intensity-map',)
fig_intensity_maps.caption = r'Snapshots of intensity across the whole \AR{} at $t=15\times10^3$ s. The rows correspond to the three different heating frequencies and the columns are the six EUV channels of AIA. In each column, the colorbar is on a square root scale and is normalized between zero and the maximum intensity in the low-frequency case. The color tables are the standard AIA color tables as implemented in SunPy \citep{sunpy_community_sunpypython_2015}.'
fig_intensity_maps.figure_env_name = 'figure*'
fig_intensity_maps.figure_width = r'\columnwidth' if is_onecolumn() else r'2\columnwidth'
fig_intensity_maps.placement = ''
fig_intensity_maps.fig_str = fig_str
\end{pycode}
\py[manager_results]|fig_intensity_maps|

\autoref{fig:intensity-map} shows a snapshot of the intensity map at $t=15\times10^3$ s for each channel and for the high-, intermediate-, and low-frequency nanoflare heating cases. The rows correspond to the different heating scenarios while the columns show the six channels. In each column, the intensities are normalized to the maximum intensity in the low-frequency case and are on a square root scale. In general, we find that in the high-frequency intensity maps, individual loops are difficult to distinguish while in the low-frequency case individual loops appear bright relative to the surrounding emission. This distinguishability or ``fuzziness'' can be measured quantitatively as $\sigma_{I}/\bar{I}$, where $\sigma_{I}$ is the standard deviation taken over all pixels and $\bar{I}$ is the mean intensity \citep[Equation 11]{guarrasi_coronal_2010-1}. A larger value of $\sigma_{I}/\bar{I}$ indicates a greater degree of contrast and vice versa. $\sigma_{I}/\bar{I}$ for each channel and heating frequency is shown in \autoref{tab:fuzzy}. With the exception of 131 \AA{}, for every channel, the high-frequency case is the most ``fuzzy''. The low-frequency case shows the most contrast in each channel except 94 \AA{} though the margin between the low and intermediate cases is quite small in some cases.

\begin{pycode}[manager_results]
# Define fuzziness function
def fuzzy(m):
    return np.sqrt(((
        m.data[np.where(m.data > 0)] - m.data[np.where(m.data > 0)].mean())**2)
        .sum()/m.data[np.where(m.data > 0)].size
    )/m.data[np.where(m.data > 0)].mean()
# Generate table
tab = Table(
    {'Channel [\AA]': channels,
     **{f.split('_')[0].capitalize(): [fuzzy(Map(path_format.format(f,t,c))) for c in channels]
        for f in heating}
    }
)
# Write table to string
caption = r'$\sigma_I/\bar{I}$ as defined by Equation 11 of \citep{guarrasi_coronal_2010-1} computed on a single image at $t=15\times10^3$ s for each channel and heating frequency. A larger value denotes a greater degree of contrast.\label{tab:fuzzy}'
formats = {'Channel [\AA]': '%.0f', **{f.split('_')[0].capitalize(): '%.2f' for f in heating}}
with io.StringIO() as f:
    ascii.write(tab, format='aastex', caption=caption, output=f, formats=formats)
    table = f.getvalue()
\end{pycode}
\py[manager_results]|table|

Looking at the first two columns of \autoref{fig:intensity-map}, we see that the intensity in the 94 and 131 \AA{} channels increases as the heating frequency decreases. Both channels are double peaked and have ``hot'' ($\approx7$ MK for 94 \AA{}, $\approx12$ MK for 131 \AA{}) and ``warm'' ($\approx1$ MK for 94 \AA{}, $\approx0.5$ MK for 131 \AA{}) components. In the case of high frequency heating, less energy is available per event such that few strands are heated to $>4$ MK. There is little emission in the 131 \AA{} channel as strands are not often permitted to cool to $\leq0.5$ MK either. However, in the low- and intermediate-frequency cases, we see several individual bright loops in both the 94 and 131 \AA{} channels as the heating rate is sufficient to produce ``hot'' (i.e. 8-10 MK) loops. We see only a few of these loops as the lifetime of this hot plasma is short due to the efficiency of thermal conduction. In contrast, the faint, diffuse component of the 94 \AA{} emission that is present in all three cases is due to the contribution of the ``warm'' component. 

Additionally, we find that the 171 \AA{} channel is dimmer for high frequency heating as the peak sensitivity of this channel is $<1$ MK and in the case of high frequency heating, strands are rarely allowed to cool below $1$ MK. In contrast, we note that the overall intensity in the 193, 211, and 335 \AA{} channels is relatively constant over heating frequency as compared to the three previous channels though individual loops do become more visible with decreasing heating frequency. This relative insensitivity is because the temperature response functions of these three channels all peak in between 1.5 MK and 2.5 MK. In the case of high-frequency heating, strands are being sustained near these temperatures while in the low-frequency case, strands are cooling through this temperature range. This is illustrated for a single strand in \autoref{fig:hydro-profiles}.

While there are clear differences in the AIA intensities between all three heating frequencies, quantifying these differences is difficult due in part to the multidimensional nature of the intensity data. To better understand how observational signatures differ as a function of heating frequency, we need to find a reduced representation of our dataset that retains signatures of the underlying energy deposition. To this end, we compute two common observables: the emission measure slope (\autoref{em_slopes}) and the timelag (\autoref{timelags}).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Emission Measure Slopes %%%%%%%%%%%%%%%%
\subsection{Emission Measure Slopes}\label{em_slopes}

As discussed in \autoref{introduction}, the emission measure slope is a useful quantity for understanding how frequently strands are reenergized. We compute emission measure distributions from our forward-modeled intensities using the regularized inversion method of \citet{hannah_differential_2012}. This method was designed to work with the narrowband coverage provided by AIA and so is well-suited to our needs. We choose our temperature bins such that the leftmost edge is at $10^{5.5}$ K and the rightmost edge at $10^{7.5}$ K with bin widths of $\Delta\log T=0.1$. Rather than computing \dem{} at each timestep, we compute the time-averaged intensity in each pixel of each channel and compute \dem{} only once. We assume uncertainties of 20\% on the forward-modeled intensity data in every pixel and every channel. After computing \dem{} in each pixel, we do a first-order polynomial fit to the log-transformed emission measure and temperature bin centers, $\log_{10}\mathrm{EM}\sim a\log_{10}T$, to calculate the emission measure slope, $a$. In \citetalias{barnes_understanding_2019-1}, we compare our modeled emission measure slopes to those derived from real AIA observations of NOAA 1158 using this same method.

\begin{pycode}[manager_results]
fig = plt.figure(figsize=texfigure.figsize(
    pytex,
    scale=1 if is_onecolumn() else 2,
    height_ratio=1/3,
    figure_width_context='columnwidth'
))
cax = fig.add_axes([0.125, 0.9, 0.775, 0.04])
params = {'cmap': 'viridis', 'vmin': 2, 'vmax': 5, 'title': False, 'annotate': False}
for i,h in enumerate(heating):
    m = Map(os.path.join(manager_results.data_dir, f'{h}', 'em_slope.fits'))
    m = m.submap(SkyCoord(Tx=-405*u.arcsec,Ty=-330*u.arcsec,frame=m.coordinate_frame),
                 SkyCoord(Tx=-210*u.arcsec,Ty=-135*u.arcsec,frame=m.coordinate_frame))
    ax = fig.add_subplot(1, len(heating), i+1, projection=m)
    im = m.plot(axes=ax, **params)
    ax.grid(alpha=0)
    lon,lat = ax.coords
    lat.set_ticks(number=3)
    lon.set_ticks(number=4)
    if i > 0:
        lon.set_ticklabel_visible(False)
        lat.set_ticklabel_visible(False)
    else:
        lon.set_axislabel('Helioprojective Longitude',)
        lat.set_axislabel('Helioprojective Latitude',)
        lat.set_ticklabel(rotation='vertical')
    xtext,ytext = m.world_to_pixel(SkyCoord(-395*u.arcsec, -150*u.arcsec, frame=m.coordinate_frame))
    ax.text(xtext.value, ytext.value, h.split('_')[0].capitalize(),
            color='k',fontsize=plt.rcParams['legend.fontsize'])
plt.subplots_adjust(hspace=0.03,wspace=0.03)
cbar = fig.colorbar(im, cax=cax, orientation='horizontal');
cbar.ax.xaxis.set_ticks_position('top')
cbar.set_ticks([2,3,4,5])
fig_slope_maps = manager_results.save_figure('em-slope-maps',)
fig_slope_maps.caption = r'Maps of the emission measure slope, $a$, in each pixel of the \AR{} for the high- (left), intermediate- (center), and low-frequency (right) cases. The \dem{} is computed using time-averaged intensities from the six AIA EUV channels using the method of \citet{hannah_differential_2012}. The \dem{} in each pixel is then fit to $T^a$ over the temperature range $5.8<\log{T}<6.4$. Any pixels with $r^2<0.9$ are masked and colored white.'
fig_slope_maps.figure_env_name = 'figure*'
fig_slope_maps.figure_width = r'\columnwidth' if is_onecolumn() else r'2\columnwidth'
fig_slope_maps.placement = ''
fig_slope_maps.fig_str = fig_str
\end{pycode}
\py[manager_results]|fig_slope_maps|

\autoref{fig:em-slope-maps} shows the resulting emission measure slope, $a$, in each pixel of our forward-modeled \AR{} for the high-, intermediate-, and low-frequency cases. We fit \dem{} over bins in the temperature range $10^{5.8}\le T\le10^{6.4}$ in order to avoid fitting across the peak of \dem{} and underestimating the slope. To assess the ``goodness-of-fit'' we use $r^2$, the correlation coefficient, and mask pixels with $r^2<0.9$. Looking at the three panels in \autoref{fig:em-slope-maps}, we find that overall, $a$ tends to decrease with decreasing frequency, consistent with previous modeling work (see \autoref{introduction}). The low frequency map (right panel) shows many values close to 2.

As the heating frequency increases, the slopes become larger, indicating an increasingly isothermal emission measure distribution. The intermediate-frequency map (center panel) shows predominantly higher slopes, with most pixels in the range $2.5\lesssim a \lesssim 3$ while the high-frequency map (left panel) shows many slopes in the range $4\lesssim a\lesssim5$. Note that in the high frequency case, the largest slopes are found in loops rooted in the strongest magnetic flux concentrations (see \autoref{fig:magnetogram}) while the distribution of $a$ appears more spatially uniform in the intermediate- and low-frequency cases.

Below $T(\mathrm{EM}_{max})$, \citet{cargill_implications_1994} noted that the \dem{} could be described by $\mathrm{EM}(T)\sim n^2\tau_{rad}$, where $\tau_{rad}\sim T^{1-\alpha}n^{-1}$ is the radiative cooling time. Additionally, \citet{bradshaw_cooling_2010} found that $T\sim n^{\ell}$, with $\ell\approx1$ for long loops and $\ell\approx2$ for short loops. Combining these expressions and assuming $\alpha=-1/2$ \citep[i.e. using the radiative losses of][]{rosner_dynamics_1978} gives $a\approx2$ for short loops and $a\approx2.5$ for long loops in the case of single nanoflares. We find that emission measure slopes produced by low-frequency nanoflares as shown in the right panel of \autoref{fig:em-slope-maps} are consistent with analytical results for single nanoflares

\begin{pycode}[manager_results]
fig = plt.figure(figsize=texfigure.figsize(
    pytex,
    scale=0.5 if is_onecolumn() else 1,
    height_ratio=1,
    figure_width_context='columnwidth',
))
ax = fig.gca()
bins = np.arange(1, 6, 0.05)
bin_centers = (bins[:-1] + bins[1:])/2
params = {'bins': bins, 'histtype': 'step','density': False, 
          'lw': plt.rcParams['lines.linewidth']}
peaks = {}
means = {}
for i,h in enumerate(heating):
    d = Map(os.path.join(manager_results.data_dir, f'{h}', 'em_slope.fits')).data.flatten()
    d = d[~np.isnan(d)]
    hist, b, _ = ax.hist(d, **params, color=heating_palette()[i],
                         label=h.split('_')[0].capitalize())
    ax.axvline(x=d.mean(), ls='--', color=heating_palette()[i], lw=1)
    peaks[h] = f'{bin_centers[np.argmax(hist)]:.1f}'
    means[h] = f'{d.mean():.1f}'
ax.set_xlim(1.5, 5.5);
ax.set_xticks([2, 3, 4, 5])
ax.legend(frameon=False, loc=1)
ax.spines['top'].set_visible(False)
ax.spines['right'].set_visible(False)
ax.set_yticks(ax.get_yticks()[1:-1])
ax.spines['left'].set_bounds(ax.get_yticks()[0],ax.get_yticks()[-1])
ax.spines['bottom'].set_bounds(ax.get_xticks()[0],ax.get_xticks()[-1])
ax.set_xlabel(r'$a$')
ax.set_ylabel(r'Number of Pixels')
fig_slope_histograms = manager_results.save_figure('em-slope-histograms')
fig_slope_histograms.caption = r'Distribution of \dem{} slopes, $a$, for every pixel in the simulated \AR{} for the high-, intermediate-, and low-frequency heating scenarios as shown in \autoref{fig:em-slope-maps}. The values of $a$ are binned between 1 and 6 with bin widths of 0.05. The dashed lines denote the mean of each distribution.'
fig_slope_histograms.figure_width = r'\columnwidth'
fig_slope_histograms.placement = ''
fig_slope_histograms.fig_str = fig_str
\end{pycode}
\py[manager_results]|fig_slope_histograms|

\autoref{fig:em-slope-histograms} shows histograms of the emission measure slopes for the high-, intermediate-, and low-frequency cases. We find that the low-frequency distribution peaks at $a\approx\py[manager_results]|peaks['low_frequency']|$, inside the range expected from analytical results (see above) with a mean of $\py[manager_results]|means['low_frequency']|$. The intermediate- and high-frequency distributions peak at successively higher values, $\approx\py[manager_results]|peaks['intermediate_frequency']|$ and $\approx\py[manager_results]|peaks['high_frequency']|$ with means $\approx\py[manager_results]|means['intermediate_frequency']|$ and $\approx\py[manager_results]|means['high_frequency']|$, respectively. While the low- and intermediate-frequency distributions are more narrowly distributed around their peak values, the high-frequency distribution has a positive skew towards higher values of $a$ and the mean of the distribution is significantly greater than the value at which the distribution peaks.

Looking at the distribution of slopes across the entire \AR{} in \autoref{fig:em-slope-histograms}, we find that when the strands are heated infrequently (low frequency) such that each strand is allowed to cool fully prior to the next event, the distribution of slopes ``saturates'' in the range expected for single nanoflares, $2<a<2.5$. However, when the strands are reheated often (high frequency), the value of the slope becomes unsaturated and is subject to a range of infrequent cooling times due to the dependence of each waiting time on the power-law heating rate (see \autoref{heating}). These results are consistent with \citet{cargill_active_2014} who computed $\mathrm{EM}(T)=n^2L$ for a single strand for a range of heating frequencies and found $a$ converged to $\approx2$ for low frequency nanoflares and increased slowly with increasing heating frequency.

Our modeled emission measure slopes show that, even when accounting for the LOS integration, atomic physics, and information lost in the \dem{} inversion, signatures of the heating frequency still persist in the emission measure slope. However, while this quantity retains information about the frequency of energy deposition, drawing conclusions about the heating based solely on the observed emission measure slope, particularly for a small number of pixels may be misleading. As shown here and in \citet{del_zanna_evolution_2015}, the slope may vary significantly across a given \AR{}. Additionally, calculating \dem{} from observations is non-trivial due to several factors, including lack of unique solution to the inversion problem \citep[e.g.][]{aschwanden_benchmark_2015}, uncertainties in the atomic data, and insufficient constraints from spectroscopic observations \citep[e.g.][]{landi_isothermality_2010,winebarger_defining_2012}, among others.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Timelags %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Timelags}\label{timelags}

Next, we apply the timelag method of \citet{viall_evidence_2012} to our synthetic intensities for all of the heating scenarios discussed in \autoref{heating}. For each pixel in the active region, we compute the cross-correlation (\autoref{eq:cc}) for all pairs of the EUV channels of AIA (15 in total) and find the temporal offset which maximizes the cross-correlation according to \autoref{eq:timelag}. The details of the cross-correlation and timelag calculation are given in \autoref{timelag_details}. We consider all possible offsets over the interval $\pm6$ hours. Using the convention of \citet{viall_evidence_2012}, we order the channel pairs such that the ``hot'' channel is listed first, meaning that a positive timelag corresponds to variability in the hotter channel followed by variability in the cooler channel. In other words, \textit{a positive timelag indicates cooling plasma.} For the 94 \AA{} and 131 \AA{} channels, both of which have a bimodal temperature response function (see \autoref{fig:aia-response}), the order is determined by the component which is most dominant such that 94 \AA{} is ordered first while 131 \AA{} is ordered second. Thus, it is possible for cooling plasma to produce negative timelags in these channel pairs.

\subsubsection{Timelag Maps}\label{timelag_maps}

\begin{pycode}[manager_results]
from synthesizAR.visualize import bgry_004_idl_cmap
fig = plt.figure(figsize=texfigure.figsize(
    pytex,
    scale=1 if is_onecolumn() else 2,
    height_ratio=3/5,
    figure_width_context='columnwidth'
))
cax = fig.add_axes([0.125, -0.01, 0.775, 0.02])
heating += ['random', 'cooling']
file_format = os.path.join(manager_results.data_dir, '{}', '{}_{}_{}.fits')
correlation_threshold = 0.1
norm = matplotlib.colors.Normalize(vmin=-(5e3*u.s).to(u.s).value,
                                   vmax=(5e3*u.s).to(u.s).value)
cmap = bgry_004_idl_cmap
plot_params = {'title': False, 'annotate': False, 'norm': norm, 'cmap': cmap,}
selected_channel_pairs = [(94,335), (211,131), (193,171)]
for j,h in enumerate(heating):
    for i,cp in enumerate(selected_channel_pairs):
        m = Map(file_format.format(h, 'timelag', *cp))
        mc = Map(file_format.format(h, 'correlation', *cp))
        m = Map(m.data, m.meta, mask=np.where(mc.data<=correlation_threshold, True, False))
        m = m.submap(SkyCoord(Tx=-440*u.arcsec,Ty=-380*u.arcsec,frame=m.coordinate_frame),
                     SkyCoord(Tx=-185*u.arcsec,Ty=-125*u.arcsec,frame=m.coordinate_frame))
        ax = fig.add_subplot(len(selected_channel_pairs), len(heating), j+len(heating)*i+1,
                             projection=m)
        im = m.plot(axes=ax, **plot_params)
        ax.grid(alpha=0)
        lon = ax.coords[0]
        lat = ax.coords[1]
        lon.set_ticks(number=3)
        lat.set_ticks(number=3,) 
        if j == 0 and i == 1:
            lat.set_axislabel(r'Helioprojective Latitude',)
            lat.set_ticklabel(rotation='vertical')
        else:
            lat.set_ticklabel_visible(False)
        if j == 1 and i == 2:
            lon.set_axislabel(r'Helioprojective Longitude',)
        else:
            lon.set_ticklabel_visible(False)
        if i == 0:
            ax.set_title(h.split('_')[0].capitalize())
        if j == 0:
            xtext,ytext = m.world_to_pixel(SkyCoord(-425*u.arcsec, -165*u.arcsec, frame=m.coordinate_frame))
            ax.text(xtext.value, ytext.value, '{}-{} $\mathrm{{\AA}}$'.format(*cp),
                    color='k', fontsize=plt.rcParams['legend.fontsize'])
plt.subplots_adjust(wspace=0.03,hspace=0.03)
cbar = fig.colorbar(im, cax=cax,orientation='horizontal')
fig_timelag_maps = manager_results.save_figure('timelag-maps',)
fig_timelag_maps.caption = r'Timelag maps for three different channel pairs for all five of the heating models described in \autoref{tab:heating}. The value of each pixel indicates the temporal offset which maximizes the cross-correlation (see \autoref{eq:timelag}). The rows indicate the different channel pairs and the columns indicate the varying heating scenarios. The range of the colorbar is $\pm5000$ s.'
fig_timelag_maps.figure_env_name = 'figure*'
fig_timelag_maps.figure_width = r'\columnwidth' if is_onecolumn() else r'2\columnwidth'
fig_timelag_maps.placement = ''
fig_timelag_maps.fig_str = fig_str
\end{pycode}
\py[manager_results]|fig_timelag_maps|

\autoref{fig:timelag-maps} shows $\tau_{AB}$ (\autoref{eq:timelag}) in each pixel of our simulated \AR{} for all heating scenarios listed in \autoref{tab:heating} and three selected channel pairs: 94-335 \AA{}, 211-131 \AA{}, and 193-1171 \AA{}. Blacks, blues, and greens correspond to negative timelags; reds, oranges, and yellows correspond to positive timelags; and olive green indicates zero timelag. The range of the colorbar is $\pm5000$ s. Note that the heating frequency decreases from left to right across each row. If the correlation in a given pixel is too low ($\max{\mathcal{C}_{AB}}<0.1$), the pixel is masked and colored white.

Looking at the first two rows of \autoref{fig:timelag-maps}, we find that the positive timelags in the 211-131 \AA{} channel pair are significantly longer than those in the 94-335 \AA{} pair. In the temperature range $2.5<T<7.3$ MK (94-335 \AA{}), the dominant cooling mechanism is field-aligned thermal conduction while radiative cooling dominates in the range $0.6<T<2.5$ MK (211-131 \AA{}). Because thermal conduction is far more efficient at high temperatures, the plasma spends less time in the $[T_{335},T_{94}]$ temperature range than in $[T_{131},T_{211}]$. The 193-171 \AA{} timelags for the cooling case fall in the middle as radiative cooling also tends to dominate in this temperature interval ($0.9<T<1.5$ MK), but the separation in temperature space is smaller than the 211-131 \AA{} pair. In all cases, these differences in the magnitude of the positive timelags become more apparent at lower heating frequencies.

In the 94-335 \AA{} pair, we find negative timelags in the longest loops near the edge of the \AR{}, inconsistent with our previous assertion that longer loops lead to longer, positive timelags. These loops are rooted in areas of weaker magnetic field (compared to the center) and thus do not have sufficient energy to evolve significantly into the temperature range of the ``hot'' component of the 94 \AA{} channel (see \autoref{heating}). Thus, cooling from 335 \AA{} to the cooler part of 94 \AA{} dominates the cross-correlation. These negative timelags are become more prominent as the heating frequency decreases. Our results in the cooling case are consistent with the negative 94-335 \AA{} timelags of similar magnitude observed by \citet{viall_survey_2017} in this same \AR{} though \citeauthor{viall_survey_2017} found far fewer positive 94-335 \AA{} timelags.

We also find negative 211-131 \AA{} timelags in the center of the \AR{} for the high-, intermediate-, and low-frequency cases, indicative of plasma cooling from the hot part of the 131 \AA{} channel through the 211 \AA{} channel. Though we have not shown them here, similar negative timelag signatures are present in nearly all of the other 131 \AA{} channel pairs as well. These results are consistent with that of \citet{cadavid_heating_2014} who found that in inter-moss regions of \AR{} NOAA 11250, intensity variations in the 131 \AA{} channel preceded brightenings in all other EUV channels. In the two control cases, we do not find any negative timelags as the cross-correlations in the core are dominated by uninterrupted cooling from 211 \AA{} to the cool part of 131 \AA{}.

For the 193-171 \AA{} channel pair, we find very few negative timelags because, unlike the 94 and 131 \AA{} channels, the 193 and 171 \AA{} channels are strongly peaked about a single temperature. Along with 211 \AA{}, these channels which are strongly-peaked about a single temperature are important for disambiguating the signals in channels with a bimodal temperature response function (see \autoref{fig:aia-response}).

Our simulated timelags show far fewer zero timelags than the observations of \citet{viall_evidence_2012,viall_survey_2017} and the modeling work of \citet{bradshaw_patterns_2016} due to the lack of transition region emission in our model. As shown by \citet{viall_transition_2015}, transition region emission shows near-zero timelags because every layer (or temperature) of the transition region responds in unison. However, for the 193-171 \AA{} channel pair, we find that zero timelags still dominate the inner core of the \AR{} for all five heating scenarios, suggesting that the plasma is cooling into, but not through the 171 \AA{} temperature bandpass \citep{viall_evidence_2012}. This underscores the point that zero timelags do not imply steady heating \citep[see][]{viall_transition_2015,viall_signatures_2016}.

\subsubsection{Cross-correlation Maps}\label{cross_correlation_maps}

\begin{pycode}[manager_results]
fig = plt.figure(figsize=texfigure.figsize(
    pytex,
    scale=1 if is_onecolumn() else 2,
    height_ratio=3/5,
    figure_width_context='columnwidth'
))
cax = fig.add_axes([0.125, -0.01, 0.775, 0.02])
plot_params = {'title': False, 'annotate': False, 'vmin': 0, 'vmax': 1, 'cmap': 'magma',}
for j,h in enumerate(heating):
    for i,cp in enumerate(selected_channel_pairs):
        m = Map(file_format.format(h, 'correlation', *cp))
        m = m.submap(SkyCoord(Tx=-440*u.arcsec,Ty=-380*u.arcsec,frame=m.coordinate_frame),
                     SkyCoord(Tx=-185*u.arcsec,Ty=-125*u.arcsec,frame=m.coordinate_frame))
        ax = fig.add_subplot(len(selected_channel_pairs), len(heating), j+len(heating)*i+1,
                             projection=m)
        im = m.plot(axes=ax, **plot_params)
        ax.grid(alpha=0)
        lon = ax.coords[0]
        lat = ax.coords[1]
        lon.set_ticks(number=3,color='w')
        lat.set_ticks(number=3,color='w')
        lon.frame.set_linewidth(0)
        lat.frame.set_linewidth(0)
        if j == 0 and i == 1:
            lat.set_axislabel(r'Helioprojective Latitude',)
            lat.set_ticklabel(rotation='vertical')
        else:
            lat.set_ticklabel_visible(False)
        if j == 1 and i == 2:
            lon.set_axislabel(r'Helioprojective Longitude',)
        else:
            lon.set_ticklabel_visible(False)
        if i == 0:
            ax.set_title(h.split('_')[0].capitalize())
        if j == 0:
            xtext,ytext = m.world_to_pixel(SkyCoord(-425*u.arcsec, -165*u.arcsec, frame=m.coordinate_frame))
            ax.text(xtext.value, ytext.value, '{}-{} $\mathrm{{\AA}}$'.format(*cp),
                    color='w', fontsize=plt.rcParams['legend.fontsize'])
plt.subplots_adjust(wspace=0.03, hspace=0.03)
cbar = fig.colorbar(im, cax=cax,orientation='horizontal')
fig_correlation_maps = manager_results.save_figure('correlation-maps',)
fig_correlation_maps.caption = r'Same as \autoref{fig:timelag-maps} except each pixel shows the maximum cross-correlation, $\max\mathcal{C}_{AB}$.'
fig_correlation_maps.figure_env_name = 'figure*'
fig_correlation_maps.figure_width = r'\columnwidth' if is_onecolumn() else r'2\columnwidth'
fig_correlation_maps.placement = ''
fig_correlation_maps.fig_str = fig_str
\end{pycode}
\py[manager_results]|fig_correlation_maps|

\autoref{fig:correlation-maps} shows the peak cross-correlation value, $\max\mathcal{C}_{AB}$, for each selected channel pair. Looking first at all three channel pairs, we see that, on average, the cross-correlation increases as the heating frequency decreases. Additionally, we find that the highest cross-correlations tend to be in the center of the \AR{} while the lowest tend to be on the outer edge. Comparing \autoref{fig:correlation-maps} with the timelags in \autoref{fig:timelag-maps} also reveals that negative timelags are correlated with lower peak cross-correlation values. Furthermore, other than the ``cooling'' scenario, we find that there are large variations from one loop to the next for all heating frequencies such that the spatial coherence of these peak cross-correlation values is low. In \citetalias{barnes_understanding_2019-1}, we will use the peak cross-correlation value, in addition to the timelag, to classify the heating frequency in each observed pixel.

\subsubsection{Histograms}\label{histograms}

\begin{pycode}[manager_results]
fig,axes = plt.subplots(
    len(channel_pairs), len(heating),
    figsize=texfigure.figsize(
        pytex,
        scale=1 if is_onecolumn() else 2,
        height_ratio=1.0,
        figure_width_context='columnwidth'
))
bins = np.arange((-10e3*u.s).value, (10e3*u.s).value, (60*u.s).value)
plot_params = {'histtype':'step', 'bins':bins,'log':True,
                'lw': 1}
from formatting import heating_palette
colors = heating_palette(n_colors=len(heating))
for i,cp in enumerate(channel_pairs):
    for j,h in enumerate(heating):
        ax = axes[i,j]
        # Select Map and Mask
        m = Map(file_format.format(h,'timelag',*cp))
        mc = Map(file_format.format(h,'correlation',*cp))
        m = Map(m.data, m.meta, mask=np.where(mc.data<=correlation_threshold, True, False))
        hist, bins, _ = ax.hist(m.data[~m.mask].flatten(), **plot_params, color=colors[j])
        ax.axvline(x=0, ls=':', alpha=0.75, color='k', lw=1)
        # Channel and Heating Labels
        if j==0 and (i+1)%2 != 0:
            ax.set_ylabel('{}-{}'.format(*cp))
        if j==len(heating)-1 and (i+1)%2 == 0:
            ax.set_ylabel('{}-{}'.format(*cp))
            ax.yaxis.set_label_position('right')
        if i==0:
            ax.set_title(h.split('_')[0].capitalize())
        # Limits
        ax.set_ylim(2,1e5)
        ax.set_xlim(1.1*bins[0], 1.1*bins[-1])
        # Spines and limits
        if j > 0:
            ax.spines['left'].set_visible(False)
            ax.tick_params(axis='y',which='both',length=0,labelleft=False)
        else:
            if i < len(channel_pairs) - 1:
                ax.tick_params(axis='y',which='both',labelleft=False)
        if j < len(heating)-1:
            ax.spines['right'].set_visible(False)
        if i > 0:
            ax.spines['top'].set_visible(False)
        if i < len(channel_pairs)-1:
            ax.spines['bottom'].set_visible(False)
            ax.tick_params(axis='x',which='both',length=0,labelbottom=False)
        else:
            if j > 0:
                ax.tick_params(axis='x',which='both',labelbottom=False)
axes[len(channel_pairs)-1,0].set_xlabel(r'$\tau_{AB}$ [s]')
plt.subplots_adjust(hspace=0,wspace=0)
fig_timelag_histograms = manager_results.save_figure('timelag-histograms',)
fig_timelag_histograms.caption = r'Histograms of timelag values across the whole \AR{}. The rows indicate the different channel pairs and the columns indicate the different heating models. Colors are used to denote the various heating models. The black dashed line denotes zero timelag. The bin range is $\pm10^4$ s and the bin width is 60 s. As with the timelag maps, we do not include timelags corresponding to $\mathcal{C}_{AB}<0.1$.'
fig_timelag_histograms.figure_env_name = 'figure*'
fig_timelag_histograms.figure_width = r'\columnwidth' if is_onecolumn() else r'2\columnwidth'
fig_timelag_histograms.placement = ''
fig_timelag_histograms.fig_str = fig_str
\end{pycode}
\py[manager_results]|fig_timelag_histograms|

\autoref{fig:timelag-histograms} shows histograms of timelags for every channel pair and all five heating scenarios. The timelags are binned between $-10^4$ s and $+10^4$ s in 60 s bins. Each histogram is colored according the corresponding heating function, consistent with \autoref{fig:hydro-profiles} and \autoref{fig:em-slope-histograms}. The columns are arranged such that heating frequency decreases from left to right. We show each channel pair for all heating models to demonstrate how the distribution of timelags evolves as the heating frequency varies.

Note that as the frequency decreases (from left to right), the number of negative timelags decreases. In the ``cooling'' case, there are very few negative timelags except for channel pairs which include one or both of the double-peaked channels (94 \AA{} and 131 \AA{}). For those channel pairs which include 94 \AA{} and/or 131 \AA{}, we expect to find negative timelags, even in the single-nanoflare cooling case as our convention of ordering the ``hot'' channel first has been violated such that cooling plasma can lead to negative timelags. For the remaining channel pairs, negative timelags are associated with the heating and cooling cycle being interrupted by repeated events on a given strand.
